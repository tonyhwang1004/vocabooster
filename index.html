<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VocaBooster - ì´ˆì¤‘ê³  í•™ìƒì„ ìœ„í•œ ì˜ì–´ ë‹¨ì–´ ì•”ê¸° í”„ë¡œê·¸ë¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            padding: 20px 0;
        }
        .container {
            max-width: 600px;
            background: rgba(255, 255, 255, 0.15);
            padding: 25px 30px;
            border-radius: 15px;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            backdrop-filter: blur(10px);
            margin: 20px auto;
        }
        h2 {
            font-size: 26px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        p {
            font-size: 14px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        label {
            font-weight: bold;
            margin-top: 12px;
            color: #ffffff;
            display: block;
        }
        select, input {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 8px;
            padding: 8px;
            font-size: 14px;
            width: 100%;
        }
        select:focus, input:focus {
            outline: none;
            box-shadow: 0px 0px 8px rgba(255, 255, 255, 0.7);
        }
        .btn-custom {
            background: #007bff;
            border: none;
            font-size: 16px;
            font-weight: bold;
            padding: 12px;
            margin-top: 20px;
            width: 100%;
            border-radius: 8px;
            color: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .btn-custom:hover {
            background: #0056b3;
            transform: scale(1.05);
        }
        .radio-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
        }
        .radio-group label {
            font-weight: normal;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: inline-block;
        }
        .radio-group input[type="radio"] {
            display: none;
        }
        .radio-group input[type="radio"]:checked + label {
            background: rgba(255, 255, 255, 0.3);
            color: #fff;
            font-weight: bold;
            transform: scale(1.1);
        }
        #error-message {
            display: none;
            color: #ff9e9e;
            font-size: 12px;
            margin-top: 5px;
            background: rgba(255, 0, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
        }
        .lesson-container {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px;
        }
        .lesson-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            text-align: left;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s;
        }
        .lesson-checkbox:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .lesson-checkbox input[type="checkbox"] {
            margin-right: 10px;
            width: auto;
        }
        .lesson-checkbox label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
        }
        .selected-count {
            font-size: 14px;
            color: #ffcc00;
            margin-top: 5px;
        }
        .selection-helpers {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            gap: 10px;
        }
        .selection-helpers button {
            font-size: 12px;
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        .selection-helpers button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .btn-game {
            padding: 12px 28px;
            font-size: 1rem;
            background: linear-gradient(to right, #ff4b2b, #ff416c);
            border: none;
            border-radius: 30px;
            color: white;
            cursor: pointer;
            box-shadow: 0 0 10px #ff4b2b;
            transition: 0.3s;
            margin-top: 15px;
        }
        .btn-game:hover {
            transform: scale(1.05);
        }
        .game-section {
            margin: 25px 0;
            text-align: center;
        }
        .footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 12px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>VocaBooster</h2>
        <p>ì´ˆì¤‘ê³  í•™ìƒì„ ìœ„í•œ ì˜ì–´ ë‹¨ì–´ ì•”ê¸° í”„ë¡œê·¸ë¨</p>

        <div id="error-message"></div>

        <form id="test-form">
            <label for="student_name">Enter Your Name:</label>
            <input type="text" id="student_name" name="student_name" required placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">

            <label for="book">Select Book:</label>
            <select id="book" name="book" required>
                <option value="">Loading books...</option>
            </select>

            <label>Select Lessons:</label>
            <div class="selected-count">Selected: <span id="selected-lessons-count">0</span> lessons</div>

            <div class="selection-helpers">
                <button type="button" id="select-all">Select All</button>
                <button type="button" id="select-none">Clear All</button>
                <button type="button" id="select-first-5">First 5</button>
                <button type="button" id="select-last-5">Last 5</button>
            </div>

            <div class="lesson-container" id="lesson-checkboxes">
                <div class="text-center py-3">Please select a book first</div>
            </div>

            <label for="question_count">Number of Questions:</label>
            <select id="question_count" name="question_count">
                <option value="-1">ì›ë˜ ê°œìˆ˜ëŒ€ë¡œ</option>
                <option value="20">20 Questions</option>
                <option value="30">30 Questions</option>
                <option value="40" selected>40 Questions</option>
                <option value="60">60 Questions</option>
                <option value="80">80 Questions</option>
                <option value="100">100 Questions</option>
            </select>

            <label>Choose Test Mode:</label>
            <div style="font-size: 13px; color: #ffeaa7; margin-top: 5px;">
                â€» ì´ˆÂ·ì¤‘ë“± í•™ìƒì€ <strong>í•œì˜ ëª¨ë“œ</strong>, ê³ ë“±í•™ìƒì€ <strong>ì˜í•œ ëª¨ë“œ</strong>ë¥¼ ì£¼ë¡œ ì„ íƒí•©ë‹ˆë‹¤.
            </div>
            <div class="radio-group">
                <input type="radio" name="test_mode" value="kor_to_eng" id="kor_to_eng" checked>
                <label for="kor_to_eng">í•œì˜ (Korean â†’ English)</label>
                <input type="radio" name="test_mode" value="eng_to_kor" id="eng_to_kor">
                <label for="eng_to_kor">ì˜í•œ (English â†’ Korean)</label>
            </div>

            <button type="submit" class="btn-custom" id="start-test-btn">Start Test</button>
        </form>

        <div class="game-section">
            <h4>ğŸ® ë‹¨ì–´ ê²Œì„ ëª¨ë“œ</h4>
            <p style="color: #ccc; margin-bottom: 12px;">ì§€ë£¨í•œ í…ŒìŠ¤íŠ¸ ëŒ€ì‹ ! ë‹¨ì–´ í­íƒ„ì„ ë§ì¶”ë©° ì¬ë¯¸ìˆê²Œ ê³µë¶€í•´ë³´ì„¸ìš”!</p>
            <button id="bombGameBtn" class="btn-game">
                ğŸ’£ Falling Word Bomb ê²Œì„ ì‹œì‘í•˜ê¸°
            </button>
        </div>

        <div class="footer">
            <p><strong>VOCABOOSTER</strong> - ì´ˆì¤‘ê³  ì˜ì–´ ë‹¨ì–´ ì•”ê¸°í”„ë¡œê·¸ë¨</p>
            <p>ì œê³µ: ê¹€ì—„ë§ˆê´€ë¦¬í˜•ë…ì„œì‹¤ & ìˆ˜ë¦¬ë”©ì–´í•™ì›</p>
            <p>Â© 2025 VocaBooster. All Rights Reserved.</p>
        </div>
    </div>

    <script>
        // GitHub Pages ê¸°ë³¸ ê²½ë¡œ ì„¤ì •
        function getBasePath() {
            const pathname = window.location.pathname;
            if (pathname.endsWith('.html')) {
                return pathname.substring(0, pathname.lastIndexOf('/') + 1);
            }
            return pathname.endsWith('/') ? pathname : pathname + '/';
        }
        const BASE_PATH = getBasePath();

        // ì „ì—­ ë³€ìˆ˜
        let booksData = [];

        // DOM ìš”ì†Œ
        const bookSelect = document.getElementById('book');
        const lessonContainer = document.getElementById('lesson-checkboxes');
        const errorMessage = document.getElementById('error-message');
        const testForm = document.getElementById('test-form');
        const selectedLessonsCount = document.getElementById('selected-lessons-count');

        // ì±… ëª©ë¡ ë¡œë“œ
        async function loadBooks() {
            try {
                const pathsToTry = [
                    BASE_PATH + 'data/books.json',
                    './data/books.json',
                    '/vocabooster/data/books.json'
                ];

                let loaded = false;
                for (const url of pathsToTry) {
                    try {
                        console.log('Trying books URL:', url);
                        const response = await fetch(url);
                        if (response.ok) {
                            booksData = await response.json();
                            console.log('Books loaded:', booksData.length);
                            loaded = true;
                            break;
                        }
                    } catch (e) {
                        console.log('Failed:', url);
                    }
                }

                if (!loaded || booksData.length === 0) {
                    showError('ì±… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // ì±… ì˜µì…˜ ì¶”ê°€
                bookSelect.innerHTML = '<option value="">Select a book</option>';
                booksData.forEach(book => {
                    const option = document.createElement('option');
                    option.value = book.folder;
                    option.textContent = book.name;
                    option.dataset.folder = book.folder;
                    bookSelect.appendChild(option);
                });

                hideError();
            } catch (error) {
                console.error('ì±… ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                showError('ì±… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë ˆìŠ¨ ëª©ë¡ í‘œì‹œ
        function loadLessonsForBook(bookFolder) {
            if (!bookFolder) {
                lessonContainer.innerHTML = '<div class="text-center py-3">Please select a book first</div>';
                return;
            }

            const book = booksData.find(b => b.folder === bookFolder);
            if (!book) {
                lessonContainer.innerHTML = '<div class="text-center py-3">ì±… ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            lessonContainer.innerHTML = '';
            book.lessons.forEach(lesson => {
                const checkboxDiv = document.createElement('div');
                checkboxDiv.className = 'lesson-checkbox';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = 'lessons';
                checkbox.value = lesson;
                checkbox.id = `lesson-${lesson}`;
                checkbox.addEventListener('change', updateSelectedCount);

                const label = document.createElement('label');
                label.setAttribute('for', `lesson-${lesson}`);
                label.textContent = lesson;

                checkboxDiv.appendChild(checkbox);
                checkboxDiv.appendChild(label);
                lessonContainer.appendChild(checkboxDiv);
            });

            updateSelectedCount();
        }

        // ì„ íƒëœ ë ˆìŠ¨ ìˆ˜ ì—…ë°ì´íŠ¸
        function updateSelectedCount() {
            const checkedLessons = document.querySelectorAll('input[name="lessons"]:checked');
            selectedLessonsCount.textContent = checkedLessons.length;
        }

        // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        // ì˜¤ë¥˜ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
        function hideError() {
            errorMessage.style.display = 'none';
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', function() {
            loadBooks();

            // ì±… ì„ íƒ
            bookSelect.addEventListener('change', function() {
                loadLessonsForBook(this.value);
            });

            // ì „ì²´ ì„ íƒ
            document.getElementById('select-all').addEventListener('click', function() {
                document.querySelectorAll('input[name="lessons"]').forEach(cb => cb.checked = true);
                updateSelectedCount();
            });

            // ì „ì²´ í•´ì œ
            document.getElementById('select-none').addEventListener('click', function() {
                document.querySelectorAll('input[name="lessons"]').forEach(cb => cb.checked = false);
                updateSelectedCount();
            });

            // ì²˜ìŒ 5ê°œ
            document.getElementById('select-first-5').addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('input[name="lessons"]');
                checkboxes.forEach((cb, i) => cb.checked = i < 5);
                updateSelectedCount();
            });

            // ë§ˆì§€ë§‰ 5ê°œ
            document.getElementById('select-last-5').addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('input[name="lessons"]');
                checkboxes.forEach((cb, i) => cb.checked = i >= checkboxes.length - 5);
                updateSelectedCount();
            });

            // í…ŒìŠ¤íŠ¸ í¼ ì œì¶œ
            testForm.addEventListener('submit', function(e) {
                e.preventDefault();

                const studentName = document.getElementById('student_name').value;
                const bookFolder = bookSelect.value;
                const book = booksData.find(b => b.folder === bookFolder);
                const bookName = book ? book.name : bookFolder;
                const lessons = Array.from(document.querySelectorAll('input[name="lessons"]:checked')).map(cb => cb.value);
                const count = document.getElementById('question_count').value;
                const mode = document.querySelector('input[name="test_mode"]:checked').value;

                if (!studentName) {
                    showError('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (!bookFolder) {
                    showError('ì±…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (lessons.length === 0) {
                    showError('ìµœì†Œ í•˜ë‚˜ì˜ ë ˆìŠ¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                // test.htmlë¡œ ì´ë™
                const url = `test.html?name=${encodeURIComponent(studentName)}&book=${encodeURIComponent(bookName)}&folder=${encodeURIComponent(bookFolder)}&lessons=${encodeURIComponent(lessons.join(','))}&count=${count}&mode=${mode}`;
                window.location.href = url;
            });

            // ê²Œì„ ë²„íŠ¼
            document.getElementById('bombGameBtn').addEventListener('click', function() {
                const bookFolder = bookSelect.value;
                const book = booksData.find(b => b.folder === bookFolder);
                const bookName = book ? book.name : bookFolder;
                const lessons = Array.from(document.querySelectorAll('input[name="lessons"]:checked')).map(cb => cb.value);

                if (!bookFolder) {
                    alert('ì±…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (lessons.length === 0) {
                    alert('ìµœì†Œ í•˜ë‚˜ì˜ ë ˆìŠ¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                const url = `falling_bomb.html?book=${encodeURIComponent(bookName)}&folder=${encodeURIComponent(bookFolder)}&lessons=${encodeURIComponent(lessons.join(','))}`;
                window.location.href = url;
            });
        });
    </script>
</body>
</html>

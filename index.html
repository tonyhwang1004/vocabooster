<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VocaBooster - ì´ˆì¤‘ê³  í•™ìƒì„ ìœ„í•œ ì˜ì–´ ë‹¨ì–´ ì•”ê¸° í”„ë¡œê·¸ë¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            padding: 20px 0;
        }
        .container {
            max-width: 600px;
            background: rgba(255, 255, 255, 0.15);
            padding: 25px 30px;
            border-radius: 15px;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            backdrop-filter: blur(10px);
            margin: 20px auto;
        }
        h2 {
            font-size: 26px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        p {
            font-size: 14px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        label {
            font-weight: bold;
            margin-top: 12px;
            color: #ffffff;
            display: block;
        }
        select, input {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 8px;
            padding: 8px;
            font-size: 14px;
        }
        select:focus, input:focus {
            outline: none;
            box-shadow: 0px 0px 8px rgba(255, 255, 255, 0.7);
        }
        .btn-custom {
            background: #007bff;
            border: none;
            font-size: 16px;
            font-weight: bold;
            padding: 12px;
            margin-top: 20px;
            width: 100%;
            border-radius: 8px;
            color: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .btn-custom:hover {
            background: #0056b3;
            transform: scale(1.05);
        }
        .radio-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
        }
        .radio-group label {
            font-weight: normal;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: inline-block;
        }
        .radio-group input[type="radio"] {
            display: none;
        }
        .radio-group input[type="radio"]:checked + label {
            background: rgba(255, 255, 255, 0.3);
            color: #fff;
            font-weight: bold;
            transform: scale(1.1);
        }
        .spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 0.15em solid currentColor;
            border-right-color: transparent;
            border-radius: 50%;
            animation: spinner-border .75s linear infinite;
            margin-right: 0.5rem;
        }
        @keyframes spinner-border {
            to { transform: rotate(360deg); }
        }
        #error-message {
            display: none;
            color: #ff9e9e;
            font-size: 12px;
            margin-top: 5px;
            background: rgba(255, 0, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
        }
        .lesson-container {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px;
        }
        .lesson-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            text-align: left;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s;
        }
        .lesson-checkbox:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .lesson-checkbox input[type="checkbox"] {
            margin-right: 10px;
        }
        .lesson-checkbox label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
        }
        .selected-count {
            font-size: 14px;
            color: #ffcc00;
            margin-top: 5px;
        }
        .selection-helpers {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            gap: 10px;
        }
        .selection-helpers button {
            font-size: 12px;
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        .selection-helpers button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .btn-today-result {
            display: inline-block;
            margin-top: 12px;
            padding: 10px 20px;
            font-weight: bold;
            background: linear-gradient(to right, #4facfe, #00f2fe);
            color: white;
            border-radius: 12px;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            text-decoration: none;
        }
        .btn-today-result:hover {
            background: linear-gradient(to right, #43e97b, #38f9d7);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
        }
        .analysis-section {
            margin-top: 25px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
        }
        .analysis-title {
            color: #fff;
            font-size: 18px;
            margin-bottom: 15px;
        }
        .analysis-form .input-group {
            display: flex;
            gap: 10px;
        }
        .analysis-input {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
        }
        .btn-analysis {
            background: linear-gradient(to right, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-analysis:hover {
            transform: scale(1.05);
        }
        .divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
            margin: 25px 0;
        }
        .app-footer {
            margin-top: 20px;
            padding: 20px 0;
            text-align: center;
        }
        .app-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .app-subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        .provider {
            font-size: 13px;
            margin-bottom: 15px;
        }
        .footer-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .footer-link {
            color: white;
            text-decoration: none;
            font-size: 13px;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        .footer-link:hover {
            opacity: 1;
            color: white;
        }
        .copyright {
            font-size: 12px;
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>VocaBooster</h2>

        <div id="error-message"></div>

        <form id="test-form">
            <label for="student_name">Enter Your Name:</label>
            <input type="text" class="form-control" id="student_name" name="student_name" required>

            <label for="book">Select Book:</label>
            <select class="form-select" id="book" name="book" required>
                <option value="">Select a book</option>
            </select>

            <label>Select Lessons:</label>
            <div class="selected-count">Selected: <span id="selected-lessons-count">0</span> lessons</div>

            <div class="selection-helpers">
                <button type="button" id="select-all">Select All</button>
                <button type="button" id="select-none">Clear All</button>
                <button type="button" id="select-first-5">First 5</button>
                <button type="button" id="select-last-5">Last 5</button>
            </div>

            <div class="lesson-container" id="lesson-checkboxes">
                <div class="text-center py-3">Please select a book first</div>
            </div>

            <label for="question_count">Number of Questions:</label>
            <select class="form-select" id="question_count" name="question_count">
                <option value="-1">ì›ë˜ ê°œìˆ˜ëŒ€ë¡œ</option>
                <option value="20">20 Questions</option>
                <option value="30">30 Questions</option>
                <option value="40" selected>40 Questions</option>
                <option value="60">60 Questions</option>
                <option value="80">80 Questions</option>
                <option value="100">100 Questions</option>
            </select>

            <label>Choose Test Mode:</label>
            <div id="mode-hint" style="font-size: 13px; color: #ffeaa7; margin-top: 5px;">
                â€» ì´ˆÂ·ì¤‘ë“± í•™ìƒì€ <strong>í•œì˜ ëª¨ë“œ</strong>, ê³ ë“±í•™ìƒì€ <strong>ì˜í•œ ëª¨ë“œ</strong>ë¥¼ ì£¼ë¡œ ì„ íƒí•©ë‹ˆë‹¤.
            </div>
            <div class="radio-group">
                <input type="radio" name="test_mode" value="kor_to_eng" id="kor_to_eng" checked>
                <label for="kor_to_eng">í•œì˜ (Korean â†’ English)</label>
                <input type="radio" name="test_mode" value="eng_to_kor" id="eng_to_kor">
                <label for="eng_to_kor">ì˜í•œ (English â†’ Korean)</label>
            </div>

            <button type="submit" class="btn btn-custom" id="start-test-btn">Start Test</button>
        </form>

        <div style="margin: 25px 0; text-align: center;">
            <h4 style="color: #fff;">ğŸ® ë‹¨ì–´ ê²Œì„ ëª¨ë“œ</h4>
            <p style="color: #ccc; margin-bottom: 12px;">ì§€ë£¨í•œ í…ŒìŠ¤íŠ¸ ëŒ€ì‹ ! ë‹¨ì–´ í­íƒ„ì„ ë§ì¶”ë©° ì¬ë¯¸ìˆê²Œ ê³µë¶€í•´ë³´ì„¸ìš”!</p>
            <button id="bombGameBtn" style="
                padding: 12px 28px;
                font-size: 1rem;
                background: linear-gradient(to right, #ff4b2b, #ff416c);
                border: none;
                border-radius: 30px;
                color: white;
                cursor: pointer;
                box-shadow: 0 0 10px #ff4b2b;
                transition: 0.3s;
            " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                ğŸ’£ Falling Word Bomb ê²Œì„ ì‹œì‘í•˜ê¸°
            </button>
        </div>

        <a href="ranking.html" class="btn-today-result">ì‹œí—˜ê²°ê³¼ ë³´ê¸°</a>

        <div class="analysis-section">
            <h4 class="analysis-title">í•™ìŠµ ì„±ê³¼ ë¶„ì„</h4>
            <div class="input-group">
                <input type="text" id="analysis_name" class="form-control analysis-input" placeholder="í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                <button type="button" id="btn-analysis" class="btn-analysis">
                    <i class="analysis-icon">ğŸ“ˆ</i> í•™ìŠµ ì„±ê³¼ ë³´ê¸°
                </button>
            </div>
        </div>

        <div class="divider"></div>

        <footer class="app-footer">
            <div class="footer-content">
                <h2 class="app-title">VOCABOOSTER</h2>
                <p class="app-subtitle">ì´ˆì¤‘ê³  ì˜ì–´ ë‹¨ì–´ ì•”ê¸°í”„ë¡œê·¸ë¨</p>
                <p class="provider">ì œê³µ: <strong>ê¹€ì—„ë§ˆê´€ë¦¬í˜•ë…ì„œì‹¤ & ìˆ˜ë¦¬ë”©ì–´í•™ì›</strong></p>
                <div class="footer-nav">
                    <a href="http://www.kimsmomsongdo.co.kr/wordbooster" class="footer-link" target="_blank">ğŸ“˜ ì´ìš©ë°©ë²•</a>
                    <a href="tel:01095794429" class="footer-link">ğŸ“ ë¬¸ì˜: 010-9579-4429</a>
                </div>
                <p class="copyright">Â© <span id="current-year">2025</span> VocaBooster. All Rights Reserved.</p>
            </div>
        </footer>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ë¡œ êµì¬ ë°ì´í„° ì €ì¥
        let booksData = [];
        
        // GitHub Pages ê¸°ë³¸ ê²½ë¡œ ì„¤ì • - ì—¬ëŸ¬ ê²½ë¡œ ì‹œë„
        function getBasePath() {
            // í˜„ì¬ í˜ì´ì§€ URLì—ì„œ ê²½ë¡œ ì¶”ì¶œ
            const pathname = window.location.pathname;
            
            // index.htmlì„ ì œê±°í•˜ê³  ë””ë ‰í† ë¦¬ ê²½ë¡œë§Œ ì¶”ì¶œ
            if (pathname.endsWith('.html')) {
                return pathname.substring(0, pathname.lastIndexOf('/') + 1);
            }
            // ê²½ë¡œê°€ /ë¡œ ëë‚˜ì§€ ì•Šìœ¼ë©´ / ì¶”ê°€
            return pathname.endsWith('/') ? pathname : pathname + '/';
        }
        
        const BASE_PATH = getBasePath();
        console.log('BASE_PATH:', BASE_PATH);

        document.addEventListener('DOMContentLoaded', function() {
            const bookSelect = document.getElementById('book');
            const lessonContainer = document.getElementById('lesson-checkboxes');
            const errorMessage = document.getElementById('error-message');
            const testForm = document.getElementById('test-form');
            const selectedLessonsCount = document.getElementById('selected-lessons-count');

            // í˜„ì¬ ì—°ë„ ì—…ë°ì´íŠ¸
            document.getElementById('current-year').textContent = new Date().getFullYear();

            // ì±… ëª©ë¡ ë¡œë“œ
            async function loadBooks() {
                try {
                    bookSelect.innerHTML = '<option value="">Loading books...</option>';
                    
                    // ì—¬ëŸ¬ ê²½ë¡œ ì‹œë„
                    const pathsToTry = [
                        BASE_PATH + 'data/books.json',
                        './data/books.json',
                        'data/books.json',
                        '/vocabooster/data/books.json'
                    ];
                    
                    let response = null;
                    let successPath = '';
                    
                    for (const path of pathsToTry) {
                        try {
                            console.log('Trying path:', path);
                            const resp = await fetch(path);
                            if (resp.ok) {
                                response = resp;
                                successPath = path;
                                console.log('Success with path:', path);
                                break;
                            }
                        } catch (e) {
                            console.log('Failed path:', path, e);
                        }
                    }
                    
                    if (!response) {
                        throw new Error('ëª¨ë“  ê²½ë¡œì—ì„œ books.jsonì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    }
                    
                    booksData = await response.json();

                    if (!booksData || booksData.length === 0) {
                        showError("ì‚¬ìš© ê°€ëŠ¥í•œ ì±… ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.");
                        return;
                    }

                    bookSelect.innerHTML = '<option value="">Select a book</option>';
                    booksData.forEach(book => {
                        const option = document.createElement('option');
                        option.value = book.name;
                        option.textContent = book.name;
                        option.setAttribute('data-folder', book.folder || book.name);
                        bookSelect.appendChild(option);
                    });

                    hideError();
                } catch (error) {
                    console.error('ì±… ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                    showError("ì±… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }
            }

            // ë ˆìŠ¨ ëª©ë¡ ë¡œë“œ
            function loadLessonsForBook(bookName) {
                if (!bookName) {
                    lessonContainer.innerHTML = '<div class="text-center py-3">Please select a book first</div>';
                    return;
                }

                const book = booksData.find(b => b.name === bookName);
                if (!book || !book.lessons || book.lessons.length === 0) {
                    lessonContainer.innerHTML = '<div class="text-center py-3">ì´ ì±…ì— ë ˆìŠ¨ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                    return;
                }

                lessonContainer.innerHTML = '';
                book.lessons.forEach(lesson => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'lesson-checkbox';

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.name = 'lessons';
                    checkbox.value = lesson;
                    checkbox.id = `lesson-${lesson}`;
                    checkbox.addEventListener('change', updateSelectedCount);

                    const label = document.createElement('label');
                    label.setAttribute('for', `lesson-${lesson}`);
                    
                    if (bookName === 'ìˆ˜ëŠ¥2000' || bookName.startsWith('ëŠ¥ë¥ ')) {
                        label.textContent = lesson;
                    } else {
                        label.textContent = `Lesson ${lesson}`;
                    }

                    checkboxDiv.appendChild(checkbox);
                    checkboxDiv.appendChild(label);
                    lessonContainer.appendChild(checkboxDiv);
                });

                updateSelectedCount();
            }

            // ì„ íƒëœ ë ˆìŠ¨ ìˆ˜ ì—…ë°ì´íŠ¸
            function updateSelectedCount() {
                const checked = document.querySelectorAll('input[name="lessons"]:checked').length;
                selectedLessonsCount.textContent = checked;
            }

            // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ/ìˆ¨ê¹€
            function showError(msg) {
                errorMessage.textContent = msg;
                errorMessage.style.display = 'block';
            }

            function hideError() {
                errorMessage.style.display = 'none';
            }

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            bookSelect.addEventListener('change', function() {
                loadLessonsForBook(this.value);
            });

            // ì„ íƒ ë„ìš°ë¯¸ ë²„íŠ¼
            document.getElementById('select-all').addEventListener('click', function() {
                document.querySelectorAll('input[name="lessons"]').forEach(cb => cb.checked = true);
                updateSelectedCount();
            });

            document.getElementById('select-none').addEventListener('click', function() {
                document.querySelectorAll('input[name="lessons"]').forEach(cb => cb.checked = false);
                updateSelectedCount();
            });

            document.getElementById('select-first-5').addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('input[name="lessons"]');
                checkboxes.forEach((cb, i) => cb.checked = i < 5);
                updateSelectedCount();
            });

            document.getElementById('select-last-5').addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('input[name="lessons"]');
                const total = checkboxes.length;
                checkboxes.forEach((cb, i) => cb.checked = i >= total - 5);
                updateSelectedCount();
            });

            // í¼ ì œì¶œ
            testForm.addEventListener('submit', function(e) {
                e.preventDefault();

                const studentName = document.getElementById('student_name').value.trim();
                const book = bookSelect.value;
                const selectedOption = bookSelect.options[bookSelect.selectedIndex];
                const bookFolder = selectedOption.getAttribute('data-folder') || book;
                const lessons = Array.from(document.querySelectorAll('input[name="lessons"]:checked')).map(cb => cb.value);
                const questionCount = document.getElementById('question_count').value;
                const testMode = document.querySelector('input[name="test_mode"]:checked').value;

                if (!studentName) {
                    showError('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (!book) {
                    showError('ì±…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (lessons.length === 0) {
                    showError('ìµœì†Œ í•˜ë‚˜ì˜ ë ˆìŠ¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                // í…ŒìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ì´ë™
                const params = new URLSearchParams({
                    name: studentName,
                    book: book,
                    folder: bookFolder,
                    lessons: lessons.join(','),
                    count: questionCount,
                    mode: testMode
                });
                window.location.href = `test.html?${params.toString()}`;
            });

            // í­íƒ„ ê²Œì„ ë²„íŠ¼
            document.getElementById('bombGameBtn').addEventListener('click', function() {
                const book = bookSelect.value;
                const selectedOption = bookSelect.options[bookSelect.selectedIndex];
                const bookFolder = selectedOption.getAttribute('data-folder') || book;
                const lessons = Array.from(document.querySelectorAll('input[name="lessons"]:checked')).map(cb => cb.value);
                const count = document.getElementById('question_count').value || '40';
                const mode = document.querySelector('input[name="test_mode"]:checked').value;

                if (!book) {
                    alert('ì±…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (lessons.length === 0) {
                    alert('ìµœì†Œ í•˜ë‚˜ì˜ ë ˆìŠ¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                const params = new URLSearchParams({
                    book: book,
                    folder: bookFolder,
                    lessons: lessons.join(','),
                    count: count,
                    mode: mode
                });
                window.location.href = `falling_bomb.html?${params.toString()}`;
            });

            // í•™ìŠµ ì„±ê³¼ ë¶„ì„ ë²„íŠ¼
            document.getElementById('btn-analysis').addEventListener('click', function() {
                const name = document.getElementById('analysis_name').value.trim();
                if (!name) {
                    alert('í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê²°ê³¼ í™•ì¸ (GitHub Pagesì—ì„œëŠ” ì„œë²„ê°€ ì—†ìœ¼ë¯€ë¡œ)
                const results = JSON.parse(localStorage.getItem('vocabooster_results') || '[]');
                const studentResults = results.filter(r => r.name === name);
                
                if (studentResults.length === 0) {
                    alert(`"${name}" í•™ìƒì˜ í•™ìŠµ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.`);
                    return;
                }
                
                window.location.href = `student_analysis.html?name=${encodeURIComponent(name)}`;
            });

            // ì´ˆê¸° ë¡œë“œ
            loadBooks();
        });
    </script>
</body>
</html>
